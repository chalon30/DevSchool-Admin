<mat-card class="usuarios-card">
  <mat-card-title>Usuarios Registrados</mat-card-title>

  <div *ngIf="cargando" class="spinner-container">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <table mat-table [dataSource]="usuarios" class="mat-elevation-z8" *ngIf="!cargando">

    <!-- ID -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let u">{{ u.id }}</td>
    </ng-container>

    <!-- Nombre -->
    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let u">{{ u.nombre }}</td>
    </ng-container>

    <!-- Apellidos -->
    <ng-container matColumnDef="apellidos">
      <th mat-header-cell *matHeaderCellDef>Apellidos</th>
      <td mat-cell *matCellDef="let u">{{ u.apellidos }}</td>
    </ng-container>

    <!-- Correo -->
    <ng-container matColumnDef="correo">
      <th mat-header-cell *matHeaderCellDef>Correo</th>
      <td mat-cell *matCellDef="let u">{{ u.correo }}</td>
    </ng-container>

    <!-- Rol -->
    <ng-container matColumnDef="rol">
      <th mat-header-cell *matHeaderCellDef>Rol</th>
      <td mat-cell *matCellDef="let u">{{ u.rol }}</td>
    </ng-container>

    <!-- Activo -->
    <ng-container matColumnDef="activo">
      <th mat-header-cell *matHeaderCellDef>Activo</th>
      <td mat-cell *matCellDef="let u">{{ u.activo ? 'Sí' : 'No' }}</td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let u">
        <button mat-raised-button color="primary" (click)="activarUsuario(u)" [disabled]="u.activo">
          Activar
        </button>
        <button mat-raised-button color="warn" (click)="abrirCambioContrasena(u)">
          Cambiar contraseña
        </button>

        <!-- Formulario de cambio de contraseña -->
        <div *ngIf="mostrarCambioId === u.id" class="form-cambio">
          <input matInput type="password" placeholder="Nueva contraseña" [(ngModel)]="nueva">
          <input matInput type="password" placeholder="Confirmar contraseña" [(ngModel)]="confirmar">
          <button mat-raised-button color="accent" (click)="cambiarContrasena(u)">Actualizar</button>
          <button mat-button (click)="cancelarCambio()">Cancelar</button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</mat-card>
